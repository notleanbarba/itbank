<html>
  <head>
    <title>ITBank homebanking</title>
    <link rel="stylesheet" href="../public/css/reset.css" />
    <link rel="stylesheet" href="../public/sass/global.css" />
    <link rel="stylesheet" href="../public/sass/responsive.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
    />
    <script defer src="../public/fontawesome/js/fontawesome.js"></script>
    <script defer src="../public/fontawesome/js/solid.js"></script>
    <script type="module">
      const currenciesList = ["ARS", "USD", "CLP", "BRL", "UYU"];

      const createCurrenciesList = (defaultCurrency = "ARS") => {
        let tmp = "";

        currenciesList.forEach((currency) => {
          if (currency === defaultCurrency)
            return (tmp = tmp.concat(
              `<option selected value="${currency}">${currency}</option>`,
            ));
          return (tmp = tmp.concat(
            `<option value="${currency}">${currency}</option>`,
          ));
        });

        return tmp;
      };

      document.getElementById("from_currency").innerHTML =
        createCurrenciesList();
      document.getElementById("to_currency").innerHTML =
        createCurrenciesList("USD");

      const getCurrencies = async () => {
        const tmp = await Promise.all(
          currenciesList.map((currency) => {
            return new Promise((res, rej) => {
              fetch(`https://open.er-api.com/v6/latest/${currency}`)
                .then((ans) => ans.json())
                .then((ans) => {
                  res({ [currency]: ans.rates });
                })
                .catch((err) => rej(err));
            });
          }),
        );
        return tmp.reduce(
          (obj, item) =>
            Object.assign(obj, {
              [Object.keys(item)[0]]: Object.values(item)[0],
            }),
          {},
        );
      };

      const rates = await getCurrencies();

      const calculateExchange = () => {
        const input_currency = document.getElementById("from_currency").value;
        const input_amount = document.getElementById("give_currency").value;
        const output_currency = document.getElementById("to_currency").value;
        const output_amount =
          rates[input_currency][output_currency] * input_amount;

        document.getElementById("receive_currency").value = output_amount;
      };

      const exchangeCalculatorDOM = document.getElementById(
        "exchange-calculator",
      );

      exchangeCalculatorDOM.addEventListener("input", calculateExchange);
    </script>
  </head>
  <body>
    <header>
      <button
        class="navbar-open"
        onclick="document.getElementById('navbar').classList.add('open')"
      >
        <i class="fa-solid fa-bars"></i>MENU
      </button>
      <h1>ITBank</h1>
      <img src="../public/logoITBA.png" alt="" />
    </header>
    <nav class="navbar" id="navbar">
      <button
        type="button"
        class="navbar-close"
        onclick="document.getElementById('navbar').classList.remove('open')"
      >
        <i class="fa-solid fa-xmark"></i>
      </button>
      <a href="../home">Inicio</a>
      <a href="../cuentas">Cuentas</a>
      <a href="../transferencias">Transferencias</a>
      <a href="../pagos">Pagos</a>
      <a href="../inversiones">Inversiones</a>
      <a href="../prestamos">Préstamos</a>
    </nav>
    <section class="content secondary">
      <div class="summary-menu">
        <div class="menu">
          <div class="content-title">Cuenta 123-45678/1</div>
          <button
            type="button"
            class="menu-selector"
            onclick="if (document.getElementById('menu-list').style.display === 'none') return document.getElementById('menu-list').style.display = 'block'; return document.getElementById('menu-list').style.display = 'none'"
          >
            Consultas y Operaciones <i class="fa-solid fa-chevron-down"></i>
          </button>
          <nav class="menu-list" id="menu-list">
            <button
              onclick="document.getElementById('exchange-modal').classList.add('open')"
            >
              Convertir divisas
            </button>
          </nav>
        </div>
        <div class="summary">
          <div class="data-with-header">
            Saldo en pesos
            <div class="data">
              <span class="balance-symbol">$</span
              ><span id="balanceARS">1000000</span>
            </div>
          </div>
          <div class="data-with-header">
            Saldo en dólares
            <div class="data">
              <span class="balance-symbol">U$D</span
              ><span id="balanceARS">1000000</span>
            </div>
          </div>
          <div class="account-info">
            <div class="account-param">
              CBU:
              <span id="account-cbu">0000000000000000000000</span>
            </div>
            <div class="account-param">
              ALIAS:
              <span id="account-alias">itbank.account</span>
            </div>
          </div>
        </div>
        <div class="tag-group">
          <div class="tag active">Movimientos en pesos</div>
          <div class="tag">Movimientos en dólares</div>
        </div>
      </div>
      <div class="page-data">
        <main>
          <p>No tenés movimientos en los últimos 7 días.</p>
          <p>Podés consultar los movimientos de los últimos 60 días.</p>
        </main>
      </div>
    </section>
    <footer>
      <div class="contFooter"><a href="#">Ultimo acceso</a></div>
      <div class="contFooterC"><a href="#">Contactanos</a></div>
    </footer>
    <div class="modal" id="exchange-modal">
      <div class="modal-dialog" role="dialog">
        <button
          type="button"
          class="modal-close"
          onclick="document.getElementById('exchange-modal').classList.remove('open')"
        >
          <i class="fa-solid fa-xmark"></i>
        </button>
        <h1>Convertir divisas</h1>
        <form id="exchange-calculator">
          <label>De</label>
          <select id="from_currency"></select>
          <label>Monto a convertir</label>
          <input type="number" id="give_currency" />
          <label>A</label>
          <select id="to_currency"></select>
          <label>Monto a recibir</label>
          <input disabled type="number" id="receive_currency" />
        </form>
      </div>
    </div>
  </body>
</html>
